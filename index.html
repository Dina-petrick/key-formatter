<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resul-TS Key Generator & Decoder</title>
  <style>
    :root{
      --bg: #0f1724;
      --card: #0b1220;
      --accent: #7c3aed;
      --muted: #94a3b8;
      --glass: rgba(255,255,255,0.03);
      --success: #10b981;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent 8%),
        radial-gradient(900px 400px at 90% 90%, rgba(16,185,129,0.06), transparent 8%),
        var(--bg);
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#e6eef8;
      padding:28px;
    }

    .card{
      width:100%;
      max-width:920px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.7);
      padding:24px;
      display:grid;
      gap:20px;
      border:1px solid rgba(255,255,255,0.03);
    }

    header{
      display:flex;
      gap:16px;
      align-items:center;
    }
    .logo {
      width:52px;
      height:52px;
      border-radius:10px;
      background:linear-gradient(135deg,var(--accent), #06b6d4);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:20px;
      color:white;
      box-shadow: 0 6px 20px rgba(124,58,237,0.18);
    }
    h1{margin:0;font-size:18px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:18px;
    }

    .field{
      background:var(--glass);
      padding:12px;
      border-radius:10px;
    }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:8px;
    }
    input[type="text"], input[type="password"]{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.03);
      background:transparent;
      color:inherit;
      outline:none;
      font-size:14px;
    }
    .row{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .btn{
      padding:10px 12px;
      border-radius:9px;
      border:0;
      cursor:pointer;
      font-weight:600;
      background:linear-gradient(90deg,var(--accent), #06b6d4);
      color:white;
      box-shadow: 0 6px 18px rgba(12,16,28,0.35);
    }
    .btn.secondary{
      background:transparent;
      border:1px solid rgba(255,255,255,0.06);
      color:var(--muted);
      font-weight:600;
    }
    .small{
      font-size:13px;
      color:var(--muted);
    }

    .result{
      background: rgba(255,255,255,0.02);
      padding:14px;
      border-radius:10px;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size:13px;
      word-break:break-all;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .result .value{flex:1}
    .muted{
      color:var(--muted);
      font-size:12px;
    }

    footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .hint{
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      border-radius:10px;
      padding:10px;
      color:var(--muted);
      font-size:13px;
    }

    @media (max-width:820px){
      .grid{grid-template-columns:1fr}
      header{gap:12px}
    }

    .ok {
      color: var(--success);
      font-weight:700;
      letter-spacing:0.2px;
    }
    .error{
      color:#fb7185;
      font-weight:700;
    }
    .copy-btn{
      padding:8px 10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      font-weight:600;
      margin-left:8px;
    }
  </style>
</head>
<body>
  <main class="card" role="main" aria-label="Resul-TS Generator and Decoder">
    <header>
      <div class="logo">RT</div>
      <div>
        <h1>Resul-TS Token Generator & Decoder</h1>
        <p class="lead">Generate or decode tokens in the format <code>Resul-TS-&lt;base64&gt;</code>. Paste or type values below and click Generate / Decode.</p>
      </div>
    </header>

    <section class="grid" aria-label="Generator and decoder panels">
      <!-- Generator -->
      <div class="field" aria-labelledby="gen-title">
        <h3 id="gen-title" style="margin:0 0 10px 0">Generate token</h3>

        <label for="three">Three-letter prefix</label>
        <input id="three" type="text" maxlength="10" placeholder="e.g. abc" autocomplete="off" />

        <label for="apikey" style="margin-top:10px">API key</label>
        <input id="apikey" type="password" placeholder="Paste your API key (kept private in UI)" autocomplete="off" />

        <label for="two" style="margin-top:10px">Two-letter suffix</label>
        <input id="two" type="text" maxlength="10" placeholder="e.g. xy" autocomplete="off" />

        <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
          <button id="generate" class="btn">Generate</button>
          <button id="showApi" class="btn secondary">Show API</button>
          <div style="margin-left:auto" class="small muted">Example: three = <code>abc</code>, two = <code>xy</code></div>
        </div>

        <div style="margin-top:14px">
          <div class="muted" style="margin-bottom:6px">Generated header</div>
          <div id="genResult" class="result" aria-live="polite">
            <div class="value muted">No token generated yet.</div>
            <div style="display:flex;align-items:center">
              <button id="copyGen" class="copy-btn" title="Copy generated token">Copy</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Decoder -->
      <div class="field" aria-labelledby="dec-title">
        <h3 id="dec-title" style="margin:0 0 10px 0">Decode token</h3>

        <label for="token">Paste Resul-TS token</label>
        <input id="token" type="text" placeholder='e.g. Resul-TS-YWJj...eHk=' autocomplete="off" />

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="decode" class="btn">Decode</button>
          <button id="clear" class="btn secondary">Clear</button>
          <div style="margin-left:auto" class="small muted">Will extract and show the inner value</div>
        </div>

        <div style="margin-top:14px">
          <div class="muted" style="margin-bottom:6px">Decoded value</div>
          <div id="decResult" class="result" aria-live="polite">
            <div class="value muted">Nothing decoded yet.</div>
            <div style="display:flex;align-items:center">
              <button id="copyDec" class="copy-btn" title="Copy decoded value">Copy</button>
            </div>
          </div>

          <div id="decodedParts" style="margin-top:10px;display:none;font-size:13px;color:var(--muted)"></div>
        </div>
      </div>
    </section>

    <footer>
      <div class="hint">
        How it works: the token is <code>Resul-TS-${"{base64_of (three + apiKey + two)}"}</code>. Use the generator to create such a header, or paste a header into the decoder to recover the original API key (decoded value will show the prefix & suffix too).
      </div>

      <div style="display:flex;gap:10px;align-items:center">
        <div class="small muted">Built for quick local use â€” your API key stays in your browser only.</div>
        <button id="about" class="btn secondary" title="About">About</button>
      </div>
    </footer>
  </main>

  <script>
    // Utility helpers
    const q = id => document.getElementById(id);
    const threeEl = q('three'), twoEl = q('two'), apiEl = q('apikey');
    const genBtn = q('generate'), genResult = q('genResult'), copyGen = q('copyGen'), showApi = q('showApi');
    const tokenEl = q('token'), decodeBtn = q('decode'), decResult = q('decResult'), copyDec = q('copyDec'), clearBtn = q('clear');
    const decodedParts = q('decodedParts'), aboutBtn = q('about');

    function safeBtoa(str) {
      // btoa on unicode strings can break; convert to Uint8Array -> base64
      try {
        return btoa(unescape(encodeURIComponent(str)));
      } catch (e) {
        // fallback manual
        let binary = '';
        const bytes = new TextEncoder().encode(str);
        const len = bytes.byteLength;
        for (let i=0;i<len;i++) binary += String.fromCharCode(bytes[i]);
        return btoa(binary);
      }
    }
    function safeAtob(b64) {
      try {
        return decodeURIComponent(escape(atob(b64)));
      } catch (e) {
        // fallback
        const binary = atob(b64);
        const bytes = new Uint8Array(binary.length);
        for (let i=0;i<binary.length;i++) bytes[i] = binary.charCodeAt(i);
        return new TextDecoder().decode(bytes);
      }
    }

    // Generate handler
    genBtn.addEventListener('click', ()=> {
      const three = (threeEl.value||'').trim();
      const two = (twoEl.value||'').trim();
      const api = (apiEl.value||'').trim();

      if (!three || !api || !two) {
        showResult(genResult, 'Please enter the three-letter prefix, the API key, and the two-letter suffix.', true);
        return;
      }
      if (three.length < 1) { showResult(genResult, 'three-letter prefix must be at least 1 character.'); return; }
      if (two.length < 1) { showResult(genResult, 'two-letter suffix must be at least 1 character.'); return; }

      const combined = three + api + two;
      const b64 = safeBtoa(combined);
      const header = 'Resul-TS-' + b64;
      showResult(genResult, header, false, true);
    });

    // Show/hide API key (toggle)
    let apishow = false;
    showApi.addEventListener('click', ()=> {
      apishow = !apishow;
      apiEl.type = apishow ? 'text' : 'password';
      showApi.textContent = apishow ? 'Hide API' : 'Show API';
    });

    // Copy handlers
    copyGen.addEventListener('click', ()=> {
      const text = getResultText(genResult);
      if (!text) return flashCopy(copyGen,false);
      navigator.clipboard?.writeText(text).then(()=> flashCopy(copyGen,true), ()=> flashCopy(copyGen,false));
    });
    copyDec.addEventListener('click', ()=> {
      const text = getResultText(decResult);
      if (!text) return flashCopy(copyDec,false);
      navigator.clipboard?.writeText(text).then(()=> flashCopy(copyDec,true), ()=> flashCopy(copyDec,false));
    });

    function flashCopy(btn, ok) {
      const prev = btn.textContent;
      btn.textContent = ok ? 'Copied' : 'Failed';
      setTimeout(()=> btn.textContent = prev, 1500);
    }

    function getResultText(container) {
      const v = container.querySelector('.value');
      if (!v) return '';
      const txt = v.textContent || '';
      if (txt.includes('No token') || txt.includes('Nothing decoded') || txt.includes('Please enter')) return '';
      return txt.trim();
    }

    function showResult(container, text, isError=false, monospace=false) {
      const val = container.querySelector('.value');
      val.textContent = text;
      val.className = 'value ' + (isError ? 'error' : monospace ? '' : 'muted');
      if (!isError && monospace) val.style.fontFamily = 'ui-monospace, SFMono-Regular, Menlo, monospace';
      if (isError) {
        // clear decoded parts when error in generator
        decodedParts.style.display = 'none';
      }
    }

    // Decode handler
    decodeBtn.addEventListener('click', ()=> {
      const raw = (tokenEl.value||'').trim();
      if (!raw) { showResult(decResult, 'Paste a Resul-TS token to decode.', true); return; }

      // Accept forms like "Resul-TS-<b64>" or just "<b64>"
      const prefix = 'Resul-TS-';
      let b64 = raw;
      if (raw.startsWith(prefix)) b64 = raw.slice(prefix.length);
      // trim possible quotes
      b64 = b64.replace(/^["']|["']$/g, '').trim();

      // basic base64 validation
      const maybe = b64.replace(/\\s+/g,'');
      if (!/^[A-Za-z0-9+/=]+$/.test(maybe)) {
        showResult(decResult, 'Not a valid Base64 string.', true);
        return;
      }

      try {
        const decoded = safeAtob(maybe);
        showResult(decResult, decoded, false, true);

        // try to split into three + api + two if lengths allow
        // We'll show possible parsed parts if three & two are small compared to the whole.
        if (decoded.length >= 3) {
          // Heuristic: if first 1-5 chars are letters and last 1-5 are letters, show them as prefix/suffix
          const maxWrap = 6;
          const maxPrefix = Math.min(maxWrap, Math.floor(decoded.length/3));
          const maxSuffix = Math.min(maxWrap, Math.floor(decoded.length/3));
          // We don't know exact three/two sizes, so assume user used typical 3 and 2
          const pref = decoded.sli
